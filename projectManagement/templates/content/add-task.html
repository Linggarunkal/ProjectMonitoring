{% extends "base/index.html" %}
{% block title %}Main Client{% endblock %}
{% block stylecss %}
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/font-awesome.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/dataTables.bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap-datetimepicker.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/style.css') }}">
{% endblock %}
{{ super() }}
{% block webcontent %}
<div class="page-wrapper">
	<div class="content container-fluid">
		<button type="button" class="close" data-dismiss="modal">&times;</button>
		<div class="modal-header">
			<h4 class="modal-title">Create Project Task</h4>
		</div>
		<div class="modal-body">
			<form>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Project Client</label>
							<select class="select" name="client_name" id="client_name">
								<option value="0">-- Select Project Client --</option>
								{% for client in allClient %}
								<option value="{{ client.client_id }}">{{ client.client_name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>Project ID</label>
							<select class="select" name="pid" id="pid">
								<option value="0">-- Select Project ID --</option>
							</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label>Category</label>
							<select class="select" name="status_project" id="status_project">
								<option value="0">-- Select Category Task --</option>
								{% for status in status %}
								<option value="{{ status.status_id }}">{{ status.status_name }}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Start Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" type="text" name="start_task" id="start_task"></div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="form-group">
							<label>End Date</label>
							<div class="cal-icon"><input class="form-control datetimepicker" style="" type="text" name="end_task" id="end_task"></div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div class="form-group">
							<label>Task Name</label>
							<select class="select" name="task_name" id="task_name">
								<option value="0">-- Select Task Project--</option>
							</select>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Assign Team</label>

							<div class="project-members">
								<a href="#" data-toggle="modal" data-target="#assign_user">
									<img src="{{ url_for('static', filename='assets/img/add2.png') }}" class="avatar" height="20" width="20">
								</a>
							</div>
						</div>
					</div>
					
				</div>
				<div class="form-group">
					<label>Description</label>
					<textarea rows="4" cols="5" class="form-control summernote" placeholder="Enter your message here"></textarea>
				</div>
				<div class="m-t-20 text-center">
					<button class="btn btn-primary">Create Task</button>
				</div>
			</form>
		</div>
	</div>
</div>
<div id="assign_user" class="modal custom-modal fade center-modal" role="dialog">
	<div class="modal-dialog">
		<button type="button" class="close" data-dismiss="modal">&times;</button>
		<div class="modal-content">
			<div class="modal-header">
				<h3 class="modal-title">Assign the user to this project</h3>
			</div>
			<div class="modal-body">
				<div class="input-group m-b-30">
					<input placeholder="Search a user to assign" class="form-control search-input input-lg" id="btn-input" type="text">
					<span class="input-group-btn">
						<button class="btn btn-primary btn-lg">Search</button>
					</span>
				</div>
					<div>
						<ul class="media-list media-list-linked chat-user-list">
							{% for team in all_team %}
							<li class="media">
								<a href="#" class="media-link">
									<div class="media-left">
										<input type="checkbox" value="{{ team.employee_id }}" class="team_project" name="team{{ team.employee_id }}" id="team{{ team.employee_id }}">

									</div>
									<div class="media-left"><span class="avatar">{{ team.initial }}</span></div>
									<div class="media-body media-middle text-nowrap">
									<div class="user-name">{{ team.firstname }} {{ team.lastname }}</div>
										<span class="designation">{{ team.title_name }} | </span>
										<span class="designation">{{ team.email }}</span>
									</div>
								</a>
							</li>
							{% endfor %}
						</ul>
					</div>
				<div class="m-t-50 text-center">
					<input class="form-control" id="employee_seleted" type="hidden" name="employee_seleted">
					<input class="form-control" id="employee_unseleted" type="hidden" name="employee_unseleted">
					<button class="btn btn-primary btn-lg" id="addTeamProject">Assign Task</button>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock %}
{% block js %}
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery-3.2.1.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.dataTables.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/dataTables.bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.slimscroll.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/select2.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/moment.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/bootstrap-datetimepicker.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='assets/js/app.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet"/>
<script type="text/javascript">
	$(document).ready(function(){
			$("#province").change(function(){
				var prov = $(this).val();
				$.ajax({
					type: "GET",
					url: "http://localhost:14045/city/detail/"+prov,
					success: function(res){
						data = JSON.parse(res);

						(function() {
    						var elm = document.getElementById('city'),
        						df = document.createDocumentFragment();
        					$('#city')
    							.find('option')
    							.remove()
    							.end();
    						for (var i = 0; i < data.length; i++) {
        						var option = document.createElement('option');
        						option.value = data[i]['city_code'];
        						option.appendChild(document.createTextNode(data[i]['city_name']));
        						df.appendChild(option);
    						}
    						elm.appendChild(df);
							}());
					}
				});
			});
		});

		$(document).ready(function(){
			$('#client_name').change(function(){
				document.getElementById("status_project").value = "0";
				document.getElementById("task_name").value = "0";
				var client_name = $(this).val();
				if (client_name != "0"){
					$.ajax({
					type: "GET",
					url: "http://localhost:14045/projectid/detail/"+client_name,
					success: function(res){
						data = JSON.parse(res);

						(function() {
    						var elm = document.getElementById('pid'),
        						df = document.createDocumentFragment();
        					$('#pid')
    							.find('option')
    							.remove()
    							.end();
    						for (var i = 0; i < data.length; i++) {
        						var option = document.createElement('option');
        						option.value = data[i]['project_id'];
        						option.appendChild(document.createTextNode(data[i]['pid']));
        						df.appendChild(option);
    						}
    						elm.appendChild(df);
							}());
						}
					});
				}else{
					document.getElementById('pid').value = "No Found data";
				}

			});
		});

		$(document).ready(function(){
			$('#pid').change(function(){
				document.getElementById("status_project").value = "0";
				document.getElementById("task_name").value = "0";
			});
		});

		$(document).ready(function(){
			$('#status_project').change(function(){
				var category = $(this).val();
				var project_id = document.getElementById('pid').value;

				$.ajax({
					type: 'GET',
					url: "http://localhost:14045/task/project/"+project_id+"/"+category,
					success: function(res){
						data = JSON.parse(res);

						(function() {
    						var elm = document.getElementById('task_name'),
        						df = document.createDocumentFragment();
        					$('#task_name')
    							.find('option')
    							.remove()
    							.end();
    						for (var i = 0; i < data.length; i++) {
        						var option = document.createElement('option');
        						option.value = data[i]['master_task_id'];
        						option.appendChild(document.createTextNode(data[i]['task_name']));
        						df.appendChild(option);
    						}
    						elm.appendChild(df);
							}());

					},
					error: function(data){
						console.log(data);
					}
				});
			});
		});

</script>
{% endblock %}
