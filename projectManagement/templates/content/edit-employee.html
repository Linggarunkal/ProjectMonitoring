{% extends "base/index.html" %}
{% block title %}Main Project{% endblock %}
{% block stylecss %}
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/font-awesome.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/bootstrap-datetimepicker.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='assets/css/style.css') }}">
{% endblock %}
{{ super() }}
{% block webcontent %}
    <div class="page-wrapper">
                <div class="content container-fluid">
					<a href="{{ url_for('emplAll') }}"><button type="button" class="close" data-dismiss="modal">&times;</button></a>

						<div class="modal-header">
							<h4 class="modal-title">Edit Employee</h4>
						</div>
						<div class="modal-body">
							<form role="form" id="addEmpNew" enctype="multipart/form-data">
								<!--basic Information-->
								<div class="card-box">
									<h3 class="card-title">Basic Informations</h3>
									<div class="row">
									<div class="col-md-12">
										<div class="profile-img-wrap">
											<img class="inline-block" src="{{ url_for('static', filename='assets/img/user.jpg') }}" alt="user">
											<div class="fileupload btn btn-default">
												<span class="btn-text">edit</span>
												<input class="upload" type="file">
											</div>
										</div>
										<div class="profile-basic">
											<div class="row">
												<div class="col-md-6">
													<div class="form-group form-focus">
														<label class="control-label">First Name</label>
														<input type="text" class="form-control floating" name="fname" id="fname"/>
													</div>
												</div>
												<div class="col-md-6">
													<div class="form-group form-focus">
														<label class="control-label">Last Name</label>
														<input type="text" class="form-control floating" name="lname" id="lname"/>
													</div>
												</div>
												<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Birth Date</label>
												<div class="cal-icon"><input class="form-control floating datetimepicker" type="text" name="birth" id="birth"/></div>
											</div>
										</div>
												<div class="col-md-6">
													<div class="form-group form-focus select-focus">
														<label class="control-label">Gender</label>
														<select class="select form-control floating" name="gender" id="gender" disabled>
															<option value="0">Select Gender</option>
															<option value="Male">Male</option>
															<option value="Female">Female</option>
														</select>
													</div>
												</div>
											</div>
										</div>
									</div></div>
								</div>
								<!--contact information-->
								<div class="card-box">
									<h3 class="card-title">Contact Informations</h3>
									<div class="row">
										<div class="col-md-12">
											<div class="form-group form-focus">
												<label class="control-label">Address</label>
												<input type="text" class="form-control floating" name="address" id="address"/>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Province</label>
												<select class="select form-control floating" name="province" id="province">
													<option value="0">Select Province</option>
													{% for prov in province %}
													<option value="{{ prov.province_id }}">{{ prov.province_name }}</option>
													{% endfor %}
												</select>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">City</label>
												<select class="select from control floating" name="city" id="city">
													<option value="0">Select City</option>
													{% for cty in city %}
													<option value="{{ cty.city_code }}">{{ cty.city_name }}</option>
													{% endfor %}
												</select>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Phone Number</label>
												<input type="text" class="form-control floating" name="phone" id="phone"/>
											</div>
										</div>
									</div>
								</div>
								<!--Information Team-->
								<div class="card-box">
									<h3 class="card-title">Information Team</h3>
									<div class="row">
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">NIK</label>
												<input type="text" disabled class="form-control floating" name="nik" id="nik"/>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Email</label>
												<input type="email" class="form-control floating" name="email" id="email" disabled/>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Password</label>
												<input type="password" class="form-control floating" name="password" id="password" disabled/>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Repeat Password</label>
												<input type="password" class="form-control floating" id="repeat_password" name="repeat_password" disabled/>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus select-focus">
												<label class="control-label">Division</label>
												<select class="select form-control floating" name="division" id="division">
													<option value="0">Select Division</option>
													{% for dept in deptName %}
													<option value="{{ dept.division_id }}">{{ dept.division_name }}</option>
													{% endfor %}
												</select>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus select-focus">
												<label class="control-label">Job Title</label>
												<select class="select form-control floating" name="job_title" id="job_title">
													<option value="0">Select Job Title</option>
													{% for job in titleName %}
													<option value="{{ job.empTitle_id }}">{{ job.title_name }}</option>
													{% endfor %}
												</select>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group form-focus">
												<label class="control-label">Join Date</label>
												<div class="cal-icon"><input type="text" class="form-control floating datetimepicker" name="join_date" id="join_date"/></div>
												<input type="hidden" id="emp_id" name="emp_id">
											</div>
										</div>
									</div>
								</div>

								<div class="text-center m-t-20">
									<button class="btn btn-primary btn-lg" type="button" id="updEmployee" name="updEmployee">Save Update</button>
								</div>
							</form>

					</div>
                </div>
            </div>
{% endblock %}
{% block js %}
    <script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery-3.2.1.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/sweetalert.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='assets/js/bootstrap.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/jquery.slimscroll.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/select2.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/moment.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/bootstrap-datetimepicker.min.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='assets/js/app.js') }}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" rel="stylesheet"/>
	<script type="text/javascript">

		var detEmployees = JSON.parse({{ getDetailEmp|tojson|safe }});

		document.getElementById('emp_id').value = detEmployees[0]['employee_id'];
		document.getElementById('fname').value = detEmployees[0]['firstname'];
		document.getElementById('lname').value = detEmployees[0]['lastname'];
		document.getElementById('birth').value = detEmployees[0]['birthday'];
		document.getElementById('gender').value = detEmployees[0]['gender'];
		document.getElementById('address').value = detEmployees[0]['address'];
		document.getElementById('province').value = detEmployees[0]['province_id'];
		document.getElementById('city').value = detEmployees[0]['city_code'];
		document.getElementById('phone').value = detEmployees[0]['phone'];
		document.getElementById('nik').value = detEmployees[0]['nik'];
		document.getElementById('email').value = detEmployees[0]['email'];
		document.getElementById('password').value = detEmployees[0]['password'];
		document.getElementById('repeat_password').value = detEmployees[0]['password'];
		document.getElementById('division').value = detEmployees[0]['division_id'];
		document.getElementById('job_title').value = detEmployees[0]['emptitle_id'];
		document.getElementById('join_date').value = detEmployees[0]['join_date'];

		$(document).ready(function(){
			$('#updEmployee').click(function(){
				var emp_id = document.getElementById('emp_id').value;
				var fname = document.getElementById('fname').value;
       			var lname = document.getElementById('lname').value;
       			var birth = document.getElementById('birth').value;
       			var gender = document.getElementById('gender').value;
       			var address = document.getElementById('address').value;
       			var province = document.getElementById('province').value;
       			var city = document.getElementById('city').value;
       			var phone = document.getElementById('phone').value;
       			var nik = document.getElementById('nik').value;
       			var password = document.getElementById('password').value;
       			var repeat_password = document.getElementById('repeat_password').value;
       			var division = document.getElementById('division').value;
       			var title = document.getElementById('job_title').value;
       			var email = document.getElementById('email').value;
       			var join_date = document.getElementById('join_date').value;

				// start of validation
				if(fname == ""){
					swal("Sorry!", " First Name must be filled out.. ", "warning")
            		var cursor = document.getElementById('fname');cursor.focus();
					return false;
				} else if(lname == ""){
					swal("Sorry!", " Last Name must be filled out.. ", "warning")
					var cursor = document.getElementById('lname');cursor.focus();
        			return false;
				}  else if(birth == 0){
					swal("Sorry!", " Birth Date must be filled out.. ", "warning")
					var cursor = document.getElementById('birth');cursor.focus();
        			return false;
				} else if(gender == 0){
					swal("Sorry!", " Gender must be filled out.. ", "warning")
					var cursor = document.getElementById('gender');cursor.focus();
        			return false;
				} else if(address == ""){
					swal("Sorry!", " Address must be filled out.. ", "warning")
					var cursor = document.getElementById('address');cursor.focus();
        			return false;
				} else if(province == 0){
					swal("Sorry!", " Province must be filled out.. ", "warning")
					var cursor = document.getElementById('province');cursor.focus();
        			return false;
				} else if(city == 0){
					swal("Sorry!", " City must be filled out.. ", "warning")
					var cursor = document.getElementById('city');cursor.focus();
        			return false;
				} else if(phone == ""){
					swal("Sorry!", " Phone Number must be filled out.. ", "warning")
					var cursor = document.getElementById('phone');cursor.focus();
        			return false;
				} else if(division == 0){
					swal("Sorry!", " Division must be filled out.. ", "warning")
					var cursor = document.getElementById('division');cursor.focus();
        			return false;
				} else if(title == 0){
					swal("Sorry!", " Title must be filled out.. ", "warning")
					var cursor = document.getElementById('title');cursor.focus();
		        	return false;
				} else if(email == ""){
					swal("Sorry!", " Email must be filled out.. ", "warning")
					var cursor = document.getElementById('email');cursor.focus();
        			return false;
				} else if(join_date == 0){
					swal("Sorry!", " Join Date must be filled out.. ", "warning")
					var cursor = document.getElementById('join_date');cursor.focus();
        			return false;
				}
				// end of validation

				data_emp = {
					'emp_id': emp_id,
					'fname': fname,
					'lname': lname,
					'birth': birth,
					'gender': gender,
					'address': address,
					'city': city,
					'phone': phone,
					'division': division,
					'job_title': job_title,
					'join_date': join_date
				}
				data_emp_json = JSON.stringify(data_emp);

				$.ajax({
					type: 'POST',
					url: '{{ url_for('empUpdDetail') }}',
					contentType: 'application/json;charset=UTF-8',
					data: data_emp_json,
					success: function(resp){
						resp_json = JSON.parse(resp);

						if(resp_json['code'] == 200){
							swal({
    							title: 'Success',
    							text: 'Update Employee Detail Success',
    							type: 'success',
    							allowOutsideClick: true,
    							html: true
								},
								function () {
    							window.location.href = "{{ url_for('emplAll') }}"
							});
						}else{
							swal({
    							title: 'Error',
    							text: 'Update Employee Detail Error',
    							icon: 'warning',
    							allowOutsideClick: true,
    							html: true
								},
								function () {
    							window.location.href = "{{ url_for('emplAll') }}"
							});
						}
					}
				});
			});
		});

		$(document).ready(function(){
			$("#province").change(function(){
				var prov = $(this).val();

				$.ajax({
					type: "GET",
					url: "http://localhost:14045/city/detail/"+prov,
					success: function(res){
						data = JSON.parse(res);
						console.log(data[0]);
						console.log(data.length);

						(function() {
    						var elm = document.getElementById('city'),
        						df = document.createDocumentFragment();
        						$('#city')
    							.find('option')
    							.remove()
    							.end();
    						for (var i = 0; i < data.length; i++) {
        						var option = document.createElement('option');
        						option.value = data[i]['city_code'];
        						option.appendChild(document.createTextNode(data[i]['city_name']));
        						df.appendChild(option);
    						}
    						elm.appendChild(df);
							}());
					}
				});
			});
		});

	$(function(){
    $('#addEmployee').click(function(){
    	event.preventDefault();
       	var form_data = new FormData($('#addEmpNew')[0]);
        $.ajax({
            url: '',
            data: '',
            type: 'POST',
            success: function(data){
                JSalert();
                function JSalert(){
                    swal("Congrats!", " Data Success created to System ", "success")
                    .then(willRedirect => {
                        if (willRedirect){
                            window.location.href = "{{ url_for('emplAll') }}";
                            }
                    });
                }
            },
            error: function(data){
                console.log(data);
            }
        });
    });
});
	</script>
{% endblock %}